{"version":3,"sources":["../src/filtersform.js"],"names":["define","$","config","init","selector","target","on","e","preventDefault","data","serializeArray","filterdata","sesskeyconfirmed","forEach","d","name","value","sesskey","parsename","match","hasCustomShortName","length","shift","rootname","type","shortname","Object","defineProperty","enumerable","writable","filterdataarray","values","filter","v","document","trigger","children","reset"],"mappings":"AAuBAA,OAAM,qCAAC,CAAC,QAAD,CAAW,aAAX,CAAD,CAA4B,SAAUC,CAAV,CAAaC,CAAb,CAAqB,CAqEnD,MA7DkB,CAENC,IAFM,CAEC,SAAUC,CAAV,CAAoB,CACnC,GAAIC,CAAAA,CAAM,CAAGJ,CAAC,CAACG,CAAD,CAAd,CAEAC,CAAM,CAACC,EAAP,CAAU,QAAV,CAAoB,MAApB,CAA4B,SAAUC,CAAV,CAAa,CACrCA,CAAC,CAACC,cAAF,GADqC,GAGjCC,CAAAA,CAAI,CAAGR,CAAC,CAAC,IAAD,CAAD,CAAQS,cAAR,EAH0B,CAIjCC,CAAU,CAAG,EAJoB,CAMjCC,CAAgB,GANiB,CAOrCH,CAAI,CAACI,OAAL,CAAa,SAAUC,CAAV,CAAa,CACtB,GAAe,SAAX,GAAAA,CAAC,CAACC,IAAN,CAA0B,CACtBH,CAAgB,CAAGE,CAAC,CAACE,KAAF,GAAYd,CAAM,CAACe,OACzC,CAFD,IAEO,CACH,GAAIC,CAAAA,CAAS,CAAGJ,CAAC,CAACC,IAAF,CAAOI,KAAP,CAAa,0CAAb,CAAhB,CACA,GAAID,CAAJ,CAAe,CACX,GAAIE,CAAAA,CAAkB,GAAtB,CACA,GAAwB,CAApB,EAAAF,CAAS,CAACG,MAAd,CAA2B,CACvBH,CAAS,CAACI,KAAV,GACAF,CAAkB,GACrB,CALU,GAMPG,CAAAA,CAAQ,CAAGL,CAAS,CAAC,CAAD,CANb,CAOPM,CAAI,CAAGN,CAAS,CAAC,CAAD,CAPT,CAQX,GAAIP,CAAU,CAACY,CAAD,CAAV,SAAJ,CAAwC,CACpCZ,CAAU,CAACY,CAAD,CAAV,CAAuB,EAC1B,CACD,GAAIH,CAAkB,EAAIT,CAAU,CAACY,CAAD,CAAV,CAAqBE,SAArB,SAA1B,CAAwE,CACpEC,MAAM,CAACC,cAAP,CAAsBhB,CAAU,CAACY,CAAD,CAAhC,CAA4C,WAA5C,CAAyD,CACrDK,UAAU,GAD2C,CAErDZ,KAAK,CAAEO,CAF8C,CAAzD,CAIH,CACD,GAAe,mCAAX,EAAAT,CAAC,CAACE,KAAN,CACA,CACI,GAAyC,WAArC,QAAOL,CAAAA,CAAU,CAACY,CAAD,CAAV,CAAqBP,KAAhC,CACE,CACEU,MAAM,CAACC,cAAP,CAAsBhB,CAAU,CAACY,CAAD,CAAhC,CAA4CC,CAA5C,CAAkD,CAC9CI,UAAU,GADoC,CAE9CZ,KAAK,CAAEF,CAAC,CAACE,KAFqC,CAG9Ca,QAAQ,GAHsC,CAAlD,CAKH,CAPD,IAOO,CACHlB,CAAU,CAACY,CAAD,CAAV,CAAqBP,KAArB,EAA8B,IAAMF,CAAC,CAACE,KACzC,CACJ,CACJ,CACJ,CACJ,CArCD,EAsCA,GAAIc,CAAAA,CAAe,CAAGJ,MAAM,CAACK,MAAP,CAAcpB,CAAd,EAA0BqB,MAA1B,CAAiC,SAAUC,CAAV,CAAa,CAChE,MAAOA,CAAAA,CAAC,CAACjB,KAAF,WAAsC,IAAZ,GAAAiB,CAAC,CAACjB,KACtC,CAFqB,CAAtB,CAGA,GAAIJ,CAAJ,CAAsB,CAClBX,CAAC,CAACiC,QAAD,CAAD,CAAYC,OAAZ,CAAoB,gCAApB,CAAsD,CAACL,CAAD,CAAtD,CACH,CACJ,CAnDD,EAoDA7B,CAAC,CAAC,iBAAD,CAAD,CAAqBK,EAArB,CAAwB,OAAxB,CAAiC,UAAY,CACzCL,CAAC,CAACI,CAAD,CAAD,CAAU+B,QAAV,CAAmB,mCAAnB,EAAwD,CAAxD,EAA2DC,KAA3D,EACH,CAFD,CAGH,CA5DiB,CA8DrB,CAtEK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A javascript module to retrieve the filter form and put it in the right location.\n * This will also make sure that submit of this form will be sent to the filter form.\n *\n * @package    local_resourcelibrary\n * @copyright  2020 CALL Learning 2020 - Laurent David laurent@call-learning.fr\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/config'], function ($, config) {\n\n    /**\n     * GradingPanel class.\n     *\n     * @class GradingPanel\n     * @param {String} selector The selector for the page region containing the user navigation.\n     */\n    var FiltersForm = {};\n\n    FiltersForm.init = function (selector) {\n        var target = $(selector);\n        // Remove any attempt to submit the form for real.\n        target.on('submit', 'form', function (e) {\n            e.preventDefault();\n            // Now we get all the current values from the form.\n            var data = $(this).serializeArray();\n            var filterdata = {};\n            // Check sesskey (if not ignore request).\n            var sesskeyconfirmed = false;\n            data.forEach(function (d) {\n                if (d.name === 'sesskey') {\n                    sesskeyconfirmed = d.value === config.sesskey;\n                } else {\n                    var parsename = d.name.match(/(customfield_)?(\\w+)\\[(\\w+)\\]\\[?(\\w*)\\]?/);\n                    if (parsename) {\n                        var hasCustomShortName = false;\n                        if (parsename.length >= 4) { // This is a customfield (value, operator, type).\n                            parsename.shift();\n                            hasCustomShortName = true;\n                        }\n                        var rootname = parsename[1];\n                        var type = parsename[2];\n                        if (filterdata[rootname] === undefined) {\n                            filterdata[rootname] = {};\n                        }\n                        if (hasCustomShortName && filterdata[rootname].shortname === undefined) {\n                            Object.defineProperty(filterdata[rootname], 'shortname', {\n                                enumerable: true, // For JSON Stringify.\n                                value: rootname\n                            });\n                        }\n                        if (d.value != \"_qf__force_multiselect_submission\") // Specific case for multiselect\n                        {\n                            if (typeof filterdata[rootname].value == \"undefined\"\n                            ) {\n                                Object.defineProperty(filterdata[rootname], type, {\n                                    enumerable: true, // For JSON Stringify.\n                                    value: d.value,\n                                    writable: true\n                                });\n                            } else {\n                                filterdata[rootname].value += ',' + d.value;\n                            }\n                        }\n                    }\n                }\n            });\n            var filterdataarray = Object.values(filterdata).filter(function (v) {\n                return v.value !== undefined || (v.value === null);\n            }); // Remove filters for which value is undefined or null.\n            if (sesskeyconfirmed) {\n                $(document).trigger('resourcelibrary-filters-change', [filterdataarray]);\n            }\n        });\n        $('#id_resetbutton').on('click', function () {\n            $(target).children('form.resourcelibrary-filters-form')[0].reset();\n        });\n    };\n    return FiltersForm;\n});\n"],"file":"filtersform.min.js"}